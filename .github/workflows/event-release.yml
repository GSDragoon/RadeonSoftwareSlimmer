name: Release

on:
  workflow_dispatch:
  push:
    tags:
      - '[1-9].[0-9]+.[0-9]+'
# git tag 1.2.3
# git push --tags

jobs:
  GitVersion:
    name: Get Version
    uses: ./.github/workflows/reuse-gitversion.yml

  CI:
    name: Continuous Integration
    needs: GitVersion
    uses: ./.github/workflows/reuse-ci.yml
    with:
      build-version: ${{ needs.GitVersion.outputs.FullSemVer }}
      archive-publish: true

  Release:
    name: Create Release
    needs: [GitVersion, CI]
    runs-on: ubuntu-latest

    steps:
    - name: Download Published Archives
      uses: actions/download-artifact@v4
      with:
        name: published-archives

    - name: List Artifacts
      run: ls -R

    # https://github.com/marketplace/actions/create-release
    - name: Create Release
      uses: ncipollo/release-action@v1
      with:
        artifactErrorsFailBuild: true
        artifacts: ./RadeonSoftwareSlimmer_*_net*.zip
        artifactContentType: application/zip
        bodyFile: ./build/release-notes-template.md
        draft: true
        generateReleaseNotes: false
        name: Radeon Software Slimmer ${{ needs.GitVersion.outputs.FullSemVer }}
        prerelease: false
        token: ${{ secrets.GITHUB_TOKEN }}
